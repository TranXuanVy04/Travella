
@model IEnumerable<Trave.Models.Tour>

@{
    ViewBag.Title = "Tour";
    // Lấy dữ liệu Dropdown từ Controller gửi sang
    var locations = ViewBag.DiaDiemList as List<Trave.Models.DiaDiem>;
    var categories = ViewBag.DanhMucList as List<Trave.Models.DanhMuc>;
}


<!-- Header Start -->
<div class="container-fluid bg-breadcrumb">
    <div class="container text-center py-5" style="max-width: 900px;">
        <h1 class="text-white display-3 mb-4">
            Travel Packages
        </h1>
        <ol class="breadcrumb justify-content-center mb-0">
            <li class="breadcrumb-item"><a href="@Url.Action("index","home")">Home</a></li>
            <li class="breadcrumb-item"><a href="#">Pages</a></li>
            <li class="breadcrumb-item active text-white">Packages</li>
        </ol>
    </div>
</div>
<!-- Header End -->
<div class="container-fluid search-bar position-relative" style="z-index: 99;">
    <div class="container">
        <div class="position-relative rounded-pill w-100 mx-auto p-4 bg-white shadow" style="margin-top: -50px;">
            @using (Html.BeginForm("Tour", "Home", FormMethod.Get))
            {
                <div class="row g-3 align-items-center">

                    <div class="col-md-5">
                        <div class="form-floating">
                            <select class="form-select border-0 bg-light" id="searchDiaDiem" name="locationId">
                                <option value="">Tất cả điểm đến...</option>
                                @if (locations != null)
                                {
                                    foreach (var item in locations)
                                    {
                                        // Kiểm tra để giữ trạng thái 'selected'
                                        var selected = Request.QueryString["locationId"] == item.MaDD ? "selected" : "";
                                        <option value="@item.MaDD" @selected>@item.ThanhPho, @item.QuocGia</option>
                                    }
                                }
                            </select>
                            <label for="searchDiaDiem"><i class="fa fa-map-marker-alt me-2 text-primary"></i>Địa điểm</label>
                        </div>
                    </div>

                    <div class="col-md-5">
                        <div class="form-floating">
                            <select class="form-select border-0 bg-light" id="searchDanhMuc" name="categoryId">
                                <option value="">Tất cả loại hình...</option>
                                @if (categories != null)
                                {
                                    foreach (var item in categories)
                                    {
                                        var selected = Request.QueryString["categoryId"] == item.MaDM ? "selected" : "";
                                        <option value="@item.MaDM" @selected>@item.TenDM</option>
                                    }
                                }
                            </select>
                            <label for="searchDanhMuc"><i class="fa fa-list-alt me-2 text-primary"></i>Danh mục</label>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <button class="btn btn-primary rounded-pill w-100 py-3" type="submit">
                            <i class="fa fa-search me-2"></i> Tìm kiếm
                        </button>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
<div class="container-fluid packages py-5">
    <div class="container py-5">
        <div class="mx-auto text-center mb-5" style="max-width: 900px;">
            <h5 class="section-title px-3">Our Packages</h5>
            <h1 class="mb-4">Awesome Packages</h1>

            @if (Model.Count() == 0)
            {
                <div class="alert alert-warning" role="alert">
                    <i class="fa fa-exclamation-circle me-2"></i> Không tìm thấy tour nào phù hợp với yêu cầu của bạn.
                    <a href="@Url.Action("Tour", "Home")" class="alert-link">Xem tất cả tour</a>.
                </div>
            }
        </div>

            <div class="packages-carousel owl-carousel">
                @foreach (var item in Model)
                {
                    <div class="packages-item p-2 h-100">
                        <div class="card package-card h-100 rounded-3 shadow-sm border-0">

                            <div class="package-img-wrapper rounded-top-3">
                                <img src="@Url.Content("~/img/Destination/"+item.anhmota)" alt="@item.TenTour">
                                <div class="category-badge shadow-sm">
                                    <i class="fa fa-tag me-1"></i> @item.DanhMuc.TenDM
                                </div>
                            </div>

                            <div class="card-body p-4 d-flex flex-column">
                                <div class="d-flex justify-content-between mb-3 package-meta">
                                    <small><i class="fa fa-map-marker-alt text-primary me-2"></i>@item.DiaDiem.ThanhPho</small>
                                    <small><i class="fa fa-clock text-primary me-2"></i>@item.ThoiGian </small>
                                </div>

                                <h5 class="card-title mb-3 fw-bold text-dark" >@item.TenTour</h5>

                                @*<div class="mb-3 text-warning">
                                    <small class="fa fa-star"></small>
                                    <small class="fa fa-star"></small>
                                    <small class="fa fa-star"></small>
                                    <small class="fa fa-star"></small>
                                    <small class="fa fa-star"></small>
                                </div>*@

                                <p class="card-text text-muted mb-4 text-clamp-3" style="font-size: 0.95rem; line-height: 1.6;">
                                    @item.mota
                                </p>

                                <hr class="text-muted opacity-25 mt-auto"> <div class="d-flex align-items-center justify-content-between mt-3">
        <div>
            <small class="text-muted d-block" style="font-size: 0.8rem;">Giá chỉ từ</small>
            <span class="price-tag">$@item.Gia</span>
        </div>
        <a class="btn btn-primary rounded-pill px-4 py-2 fw-bold shadow-sm transition-hover"
           href="@Url.Action("Details", "Home", new { id = item.MaTour.Trim() })">
            Book Now
        </a>
    </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
    </div>
</div>